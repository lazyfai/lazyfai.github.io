---
layout: post
title: Samba UID-SID mapping in multiple domains
date: '2008-09-20T18:47:00.000+08:00'
author: Fai Wong
tags:
- linux
modified_time: '2008-09-21T18:53:57.443+08:00'
blogger_id: tag:blogger.com,1999:blog-8503500.post-3298166648747160414
blogger_orig_url: http://lazyfai.blogspot.com/2008/09/samba-uid-sid-mapping-in-multiple.html
---

After days of samba studying, finally have some hint on UID-SID mapping problem, it is related to overlapping SID in multiple domain case, for example, DOMAINA\fai has SID of x-x-x-x-1001 but DOMAINB\fai has SID of y-y-y-y-1001, it is different in the point of view of Windows, but it is the same in samba, so winbind will assign DOMAINB\fai another UID in Linux side, which is unpredictable and inconsistent.<br />The worst thing is, even there is only one domain, different servers may got different mapping due to UID collision, to make it consistent, we need to use RID method in samba configuration, by:<br /><span style="font-weight: bold;">idmap backend = rid:"DOMAINA=16777216-33554431"</span><br /><span style="font-weight: bold;">idmap uid = 16777216-33554431 </span><br /><span style="font-weight: bold;">idmap gid = 16777216-33554431 </span><br />But it doesn't work for multiple domain, to entertain multiple domain case, use this:<br /><span style="font-weight: bold;">idmap domains = DOMAINA DOMAINB</span><br /><span style="font-weight: bold;">idmap config DOMAINA:default = yes </span><br /> <span style="font-weight: bold;"></span><span style="font-weight: bold;">idmap config DOMAINA:backend = rid </span><br /><span style="font-weight: bold;"></span><span style="font-weight: bold;">idmap config DOMAINB:backend = rid<br />idmap config DOMAINA:base_rid = 1000 </span><br /><span style="font-weight: bold;">idmap config DOMAINB:base_rid = 1000<br />idmap config DOMAINA:range = 10000-19999</span><br /><span style="font-weight: bold;">idmap config DOMAINB:range = 20000-29999</span><br /><span style="font-weight: bold;"></span>Together with idmap uid and idmap gid range, this can avoid any collision and make the UID-SID mapping consistent all the time.<br /><br />Source: http://www.mail-archive.com/samba@lists.samba.org/msg95890.html