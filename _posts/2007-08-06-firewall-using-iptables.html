---
layout: post
title: Firewall using iptables
date: '2007-08-06T22:07:00.000+08:00'
author: Fai Wong
tags:
- linux
modified_time: '2007-08-06T22:12:27.086+08:00'
blogger_id: tag:blogger.com,1999:blog-8503500.post-7548870229559348978
blogger_orig_url: http://lazyfai.blogspot.com/2007/08/firewall-using-iptables.html
---

節錄自 <a href="http://cha.homeip.net/blog/archives/2006/03/iptables_limit.html">Jamyy'w Weblog</a><br /><br />iptables limit 參數備忘<br /><br /><ul><li>    限制特定封包傳入速度</li><li>限制特定埠口連入頻率</li><li>防治 SYN-Flood 碎片攻擊<br /></li></ul><span style="font-weight: bold;">限制 ping (echo-request) 傳入的速度</span><br /><br />   限制前, 可正常每 0.2 秒 ping 一次<br />ping your.linux.ip -i 0.2<br /><br />   限制每秒只接受一個 icmp echo-request 封包<br />iptables -A INPUT -p icmp --icmp-type echo-request -m limit --limit 1/s --limit-burst 1 -j ACCEPT<br />   iptables -A INPUT -p icmp --icmp-type echo-request -j DROP<br />--limit 1/s 表示每秒一次; 1/m 則為每分鐘一次<br />--limit-burst 表示允許觸發 limit 限制的最大次數 (預設 5)<br /><br />   再以每 0.2 秒 ping 一次, 得到的回應是每秒一次<br />ping your.linux.ip -i 0.2<br /><br /><span style="font-weight: bold;">限制 ssh 連入頻率</span><br />建立自訂 Chain, 限制 tcp 連線每分鐘一次, 超過者觸發 Log 記錄 (記錄在 /var/log/messages)<br />iptables -N ratelimit<br />   iptables -A ratelimit -p tcp -m state --state ESTABLISHED,RELATED -j ACCEPT<br />   iptables -A ratelimit -p tcp --syn -m limit --limit 1/m --limit-burst 1 -j ACCEPT<br />   iptables -A ratelimit -p tcp -j LOG --log-level "NOTICE" --log-prefix "[RATELIMIT]"<br />   iptables -A ratelimit -p tcp -j DROP<br /><br />   引用自訂 Chain, 限制 ssh (tcp port 22) 連入頻率<br />iptables -A INPUT -p tcp --dport 22 -s 192.168.0.0/16 -j ACCEPT (特定 IP 來源不受限制)<br />   iptables -A INPUT -p tcp --dport 22 -j ratelimit<br /><br />同理可證<br />iptables -N pinglimit<br />   iptables -A pinglimit -m limit --limit 1/s --limit-burst 1 -j ACCEPT<br />   iptables -A pinglimit -j DROP<br /><br />   iptables -A INPUT -p icmp --icmp-type echo-request -j pinglimit<br />亦可達到每秒只接受一個 echo-request 封包<br /><br /><span style="font-weight: bold;">防治 SYN-Flood 碎片攻擊</span><br />   iptables -N syn-flood<br />   iptables -A syn-flood -m limit --limit 100/s --limit-burst 150 -j RETURN<br />   iptables -A syn-flood -j DROP<br />iptables -I INPUT -j syn-flood<br /><br />   模擬攻擊<br />wget http://www.xfocus.net/tools/200102/naptha-1.1.tgz<br />   wget ftp://rpmfind.net/linux/freshrpms/redhat/7.0/libnet/libnet-1.0.1b-1.src.rpm<br />   tar -zxf naptha-1.1.tgz<br />   rpmbuild --recompile libnet-1.0.1b-1.src.rpm<br />   cp -r /var/tmp/libnet-buildroot/usr/* /usr/local/<br />   cd naptha-1.1<br />   make<br /><br />   ./synsend your.linux.host.ip 80 local.host.eth0.ip 0.1<br />若成功抵擋, 不久後會出現 Can't send packet!: Operation not permitted 的訊息